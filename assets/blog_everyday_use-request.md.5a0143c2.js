import{_ as s,o as a,c as n,a as p}from"./app.ed2a374b.js";const C=JSON.parse('{"title":"React Hook - useRequest","description":"","frontmatter":{},"headers":[],"relativePath":"blog/everyday/use-request.md","lastUpdated":1679813736000}'),l={name:"blog/everyday/use-request.md"},o=p(`<h1 id="react-hook-userequest" tabindex="-1">React Hook - useRequest <a class="header-anchor" href="#react-hook-userequest" aria-hidden="true">#</a></h1><h2 id="å‰è¨€" tabindex="-1">å‰è¨€ <a class="header-anchor" href="#å‰è¨€" aria-hidden="true">#</a></h2><p>å®ç°è¿™ä¸ª Hook çš„ç›®çš„æ˜¯ä¸ºäº†<strong>å‡å°‘ React é¡¹ç›®ä¸­æ•°æ®è¯·æ±‚ç¼–å†™çš„é‡å¤ä»£ç ã€‚</strong></p><p>æœ¬æ–‡å°†ä»¥æˆ‘çš„é¡¹ç›®ä¸ºä¾‹ï¼ˆğŸ‘€ æ¯ä¸ªé¡¹ç›®çš„æ•°æ®è¯·æ±‚é£æ ¼å¯èƒ½ä¸åŒï¼Œä½†å¤§è‡´æ€è·¯ç›¸åŒï¼‰</p><p>ä¸‹é¢æ ‡è®°çš„ä»£ç å—å°±æ˜¯æ•°æ®è¯·æ±‚ç¼–å†™çš„é‡å¤ä»£ç ã€‚</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ab59a2cdaaff4da5a0926bc7f4f498a8~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20220812212303141" width="70%"><p>ç®€å•æ¦‚æ‹¬ä¸ºä»¥ä¸‹å‡ ç±»</p><ul><li>è¯·æ±‚è¿”å›æ•°æ®çš„å£°æ˜å’Œæ›´æ–°ï¼›</li><li>åŠ è½½çš„ loading çš„å£°æ˜å’Œæ›´æ–°ï¼›</li><li>try...catch é”™è¯¯æ•è·ï¼›</li><li>isSuccess æ¥å£æˆåŠŸéªŒè¯å­—æ®µ ï¼ˆä¸åŒé¡¹ç›®å­˜åœ¨å·®å¼‚ï¼‰ï¼›</li><li>......</li></ul><p>è™½ç„¶æ—¥å¸¸ä¸šåŠ¡å¼€å‘ CV å°±èƒ½è§£å†³ ğŸ¤”ï¼Œä½†æ˜¯ä»£ç å±‚é¢æ˜¾å¾—ä¸å¤Ÿä¼˜é›… ğŸ¶ã€‚</p><p>äºæ˜¯æˆ‘ Google äº†ä¸€äº›ç¤¾åŒºçš„å®ç°æ–¹æ¡ˆï¼š</p><ul><li>å®˜æ–¹æ¨èçš„ <a href="https://www.robinwieruch.de/react-hooks-fetch-data/" target="_blank" rel="noreferrer">How to fetch data with React Hooks</a> ï¼›</li><li><a href="https://github.com/streamich/react-use" target="_blank" rel="noreferrer">react-use</a> çš„ <a href="https://github.com/streamich/react-use/blob/master/docs/useAsync.md" target="_blank" rel="noreferrer">useAsync</a>ï¼Œ<a href="https://github.com/streamich/react-use/blob/master/docs/useAsyncFn.md" target="_blank" rel="noreferrer">useAsyncFn</a>ï¼›</li><li><a href="https://ahooks.js.org/" target="_blank" rel="noreferrer">ahooks</a> çš„ <a href="https://ahooks.js.org/hooks/use-request/index" target="_blank" rel="noreferrer">useRequest</a> ï¼›</li></ul><p>å®˜æ–¹æ¨èç½‘ç«™æä¾›å¾ˆå¥½çš„æ€è·¯ï¼›</p><p>react-use çš„ useAsync åªé’ˆå¯¹å¼‚æ­¥å‡½æ•°çš„å¤„ç†ï¼›</p><p>ahooks çš„ useRequest å·²ç»éå¸¸æˆç†Ÿï¼Œå¯ä»¥ç›´æ¥å¼•å…¥ä½¿ç”¨ï¼Œä½†ä¹Ÿåœ¨äºåŠŸèƒ½è¿‡äºå¼ºå¤§ï¼Œæœ‰ç‚¹æ€é¸¡ç”¨ç‰›åˆ€æ„æ€ ğŸ˜„ï¼›</p><p>å€Ÿé‰´ä»¥ä¸Šçš„å®ç°æ–¹æ¡ˆåï¼Œé’ˆå¯¹è‡ªå·±çš„ä¸šåŠ¡é¡¹ç›® <strong>å®šåˆ¶</strong> æ›´ <strong>åŸºç¡€</strong> çš„å¼‚æ­¥æ•°æ®è¯·æ±‚ Hook ã€‚</p><p>ä¸€å¼€å§‹çš„æ–¹æ¡ˆå­˜åœ¨ä¸€äº›å‘ï¼Œç»è¿‡ä¸æ–­çš„ä¼˜åŒ–è¿­ä»£ï¼Œå¾—åˆ°äº†æœ¬æ–‡æœ€ç»ˆçš„æ–¹æ¡ˆï¼Œä»…ä¾›æ˜å‹å‚è€ƒã€‚</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/68b4938852844b4c8f2e6c33ddf2a51e~tplv-k3u1fbpfcp-zoom-1.image" alt="BCBAA8AC-3BAB-4C2E-8C11-D2E93975C7D9" width="70%"><h2 id="hook-éœ€æ±‚" tabindex="-1">Hook éœ€æ±‚ <a class="header-anchor" href="#hook-éœ€æ±‚" aria-hidden="true">#</a></h2><p>ğŸŸ¢ é¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®ä» Hook ä¸­è·å–ä»€ä¹ˆ</p><ul><li><strong>data</strong>ï¼šè¯·æ±‚ç»“æœï¼›</li><li><strong>loading</strong>ï¼šç”¨äºè¡¨ç¤ºæ­£åœ¨è¯·æ±‚æ•°æ®ï¼›</li><li><strong>run</strong>ï¼šè§¦å‘å‡½æ•°ï¼›</li><li><strong>setData</strong>ï¼šäºŒæ¬¡ä¿®æ”¹ï¼›ï¼ˆè¿™ä¸ªå¯ä»¥ä¸éœ€è¦è¿”å›ï¼‰</li><li><strong>error</strong>ï¼šé”™è¯¯ä¿¡æ¯ï¼›ï¼ˆğŸ‘€ å¤§éƒ¨åˆ†å®ç°æ–¹æ¡ˆä¼šä»¥ isError çŠ¶æ€çš„å½¢å¼æŠ›å‡ºï¼Œç”±äºæˆ‘çš„é¡¹ç›®å¯¹äºé”™è¯¯è¿›è¡Œäº†å•ç‹¬çš„å¤„ç†ï¼Œè¿™é‡Œå°±ä¸éœ€è¦äº†ï¼‰</li></ul><p>ğŸŸ¢ å…¶æ¬¡æ˜¯æå– Hook å…¬å…±é€»è¾‘</p><ul><li>æ¥æ”¶å¼‚æ­¥è¯·æ±‚å‡½æ•°</li><li>è¯·æ±‚æˆåŠŸåå›è°ƒå‡½æ•°</li><li>ä½¿ç”¨ try...catch æ•è·é”™è¯¯</li><li>æ ¹æ®æ¥å£çš„è¿”å›çš„ isSuccess å­—æ®µåˆ¤æ–­</li></ul><p>ğŸŸ¢ æœ€åä½¿ç”¨ TSï¼Œç±»å‹æ¨å¯¼</p><h2 id="hook-æŠ€æœ¯æ–¹æ¡ˆ" tabindex="-1">Hook æŠ€æœ¯æ–¹æ¡ˆ <a class="header-anchor" href="#hook-æŠ€æœ¯æ–¹æ¡ˆ" aria-hidden="true">#</a></h2><p>ğŸ“‚ services/api/../index.ts</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#768390;">/**</span></span>
<span class="line"><span style="color:#768390;"> * </span><span style="color:#F47067;">@description</span><span style="color:#768390;"> æŸ¥è¯¢</span></span>
<span class="line"><span style="color:#768390;"> * </span><span style="color:#F47067;">@export</span></span>
<span class="line"><span style="color:#768390;"> * </span><span style="color:#F47067;">@param</span><span style="color:#768390;"> </span><span style="color:#F69D50;">{SearchProps}</span><span style="color:#768390;"> </span><span style="color:#ADBAC7;">params</span></span>
<span class="line"><span style="color:#768390;"> * </span><span style="color:#F47067;">@returns</span><span style="color:#768390;"> </span><span style="color:#F69D50;">{*}</span><span style="color:#768390;">  {Promise&lt;ResponseProps&lt;ListProps&gt;&gt;}</span></span>
<span class="line"><span style="color:#768390;"> */</span></span>
<span class="line"><span style="color:#F47067;">export</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">async</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">function</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">apiSearch</span><span style="color:#ADBAC7;">(</span><span style="color:#F69D50;">params</span><span style="color:#F47067;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">SearchProps</span><span style="color:#ADBAC7;">)</span><span style="color:#F47067;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">Promise</span><span style="color:#ADBAC7;">&lt;</span><span style="color:#F69D50;">ResponseProps</span><span style="color:#ADBAC7;">&lt;</span><span style="color:#F69D50;">ListProps</span><span style="color:#ADBAC7;">[]&gt;&gt; {</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> { </span><span style="color:#6CB6FF;">data</span><span style="color:#ADBAC7;"> } </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">await</span><span style="color:#ADBAC7;"> http.</span><span style="color:#DCBDFB;">get</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&#39;/.../List&#39;</span><span style="color:#ADBAC7;">, params);</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F47067;">return</span><span style="color:#ADBAC7;"> data;</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span>
<span class="line"></span></code></pre></div><p>ğŸŸ¢ å°è£…å¼‚æ­¥è¯·æ±‚å‡½æ•°ï¼Œè¿™æ ·æ–¹ä¾¿æ¥å£ç®¡ç†ã€‚</p><h3 id="å°è£…" tabindex="-1">å°è£… <a class="header-anchor" href="#å°è£…" aria-hidden="true">#</a></h3><p>ğŸ“‚ hooks\\common\\useRequest.ts</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#F47067;">import</span><span style="color:#ADBAC7;"> { ResponseProps } </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;@types&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#F47067;">import</span><span style="color:#ADBAC7;"> { useCallback, useState } </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;react&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">interface</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">UseRequestReturnType</span><span style="color:#ADBAC7;">&lt;</span><span style="color:#F69D50;">P</span><span style="color:#ADBAC7;">, </span><span style="color:#F69D50;">T</span><span style="color:#ADBAC7;">&gt; {</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#768390;">/**</span></span>
<span class="line"><span style="color:#768390;">   * </span><span style="color:#F47067;">@description</span><span style="color:#768390;"> service è¿”å›çš„æ•°æ®</span></span>
<span class="line"><span style="color:#768390;">   * </span><span style="color:#F47067;">@type</span><span style="color:#768390;"> </span><span style="color:#F69D50;">{T}</span></span>
<span class="line"><span style="color:#768390;">   */</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F69D50;">data</span><span style="color:#F47067;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">T</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#768390;">/**</span></span>
<span class="line"><span style="color:#768390;">   * </span><span style="color:#F47067;">@description</span><span style="color:#768390;"> service æ˜¯å¦æ­£åœ¨æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#768390;">   * </span><span style="color:#F47067;">@type</span><span style="color:#768390;"> </span><span style="color:#F69D50;">{boolean}</span></span>
<span class="line"><span style="color:#768390;">   */</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F69D50;">loading</span><span style="color:#F47067;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">boolean</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#768390;">/**</span></span>
<span class="line"><span style="color:#768390;">   * </span><span style="color:#F47067;">@description</span><span style="color:#768390;"> è§¦å‘ service æ‰§è¡Œï¼Œå‚æ•°ä¼šä¼ é€’ç»™ service</span></span>
<span class="line"><span style="color:#768390;">   */</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#DCBDFB;">run</span><span style="color:#F47067;">:</span><span style="color:#ADBAC7;"> (</span><span style="color:#F69D50;">params</span><span style="color:#F47067;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">P</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">=&gt;</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">void</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#768390;">/**</span></span>
<span class="line"><span style="color:#768390;">   * </span><span style="color:#F47067;">@description</span><span style="color:#768390;"> setData</span></span>
<span class="line"><span style="color:#768390;">   * </span><span style="color:#F47067;">@type</span><span style="color:#768390;"> </span><span style="color:#F69D50;">{React.Dispatch&lt;React.SetStateAction&lt;T&gt;&gt;}</span></span>
<span class="line"><span style="color:#768390;">   */</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F69D50;">setData</span><span style="color:#F47067;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">React</span><span style="color:#ADBAC7;">.</span><span style="color:#F69D50;">Dispatch</span><span style="color:#ADBAC7;">&lt;</span><span style="color:#F69D50;">React</span><span style="color:#ADBAC7;">.</span><span style="color:#F69D50;">SetStateAction</span><span style="color:#ADBAC7;">&lt;</span><span style="color:#F69D50;">T</span><span style="color:#ADBAC7;">&gt;&gt;;</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">// åˆå§‹æ•°æ®</span></span>
<span class="line"><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">initData</span><span style="color:#F47067;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">any</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">null</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">/**</span></span>
<span class="line"><span style="color:#768390;"> * </span><span style="color:#F47067;">@description</span><span style="color:#768390;"> å¼‚æ­¥æ•°æ®è¯·æ±‚çš„ Hook</span></span>
<span class="line"><span style="color:#768390;"> * </span><span style="color:#F47067;">@export</span></span>
<span class="line"><span style="color:#768390;"> * </span><span style="color:#F47067;">@template</span><span style="color:#768390;"> </span><span style="color:#ADBAC7;">P</span><span style="color:#768390;"> å…¥å‚ç±»å‹</span></span>
<span class="line"><span style="color:#768390;"> * </span><span style="color:#F47067;">@template</span><span style="color:#768390;"> </span><span style="color:#ADBAC7;">T</span><span style="color:#768390;"> å‡ºå‚ç±»å‹</span></span>
<span class="line"><span style="color:#768390;"> * </span><span style="color:#F47067;">@param</span><span style="color:#768390;"> </span><span style="color:#F69D50;">{(params: P) =&gt; Promise&lt;ResponseProps&lt;T&gt;&gt;}</span><span style="color:#768390;"> </span><span style="color:#ADBAC7;">apiService</span><span style="color:#768390;"> service</span></span>
<span class="line"><span style="color:#768390;"> * </span><span style="color:#F47067;">@param</span><span style="color:#768390;"> </span><span style="color:#F69D50;">{(result: T) =&gt; void}</span><span style="color:#768390;"> </span><span style="color:#ADBAC7;">[onSuccess]</span><span style="color:#768390;"> service resolve æ—¶è§¦å‘ å‚æ•°ä¸º data</span></span>
<span class="line"><span style="color:#768390;"> * </span><span style="color:#F47067;">@returns</span><span style="color:#768390;"> </span><span style="color:#F69D50;">{*}</span><span style="color:#768390;">  {UseRequestReturnType}</span></span>
<span class="line"><span style="color:#768390;"> */</span></span>
<span class="line"><span style="color:#F47067;">export</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">function</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">useRequest</span><span style="color:#ADBAC7;">&lt;</span><span style="color:#F69D50;">P</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">any</span><span style="color:#ADBAC7;">, </span><span style="color:#F69D50;">T</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">any</span><span style="color:#ADBAC7;">&gt;(</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#DCBDFB;">apiService</span><span style="color:#F47067;">:</span><span style="color:#ADBAC7;"> (</span><span style="color:#F69D50;">params</span><span style="color:#F47067;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">P</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">=&gt;</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">Promise</span><span style="color:#ADBAC7;">&lt;</span><span style="color:#F69D50;">ResponseProps</span><span style="color:#ADBAC7;">&lt;</span><span style="color:#F69D50;">T</span><span style="color:#ADBAC7;">&gt;&gt;,</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#DCBDFB;">onSuccess</span><span style="color:#F47067;">?:</span><span style="color:#ADBAC7;"> (</span><span style="color:#F69D50;">result</span><span style="color:#F47067;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">T</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">=&gt;</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">void</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">)</span><span style="color:#F47067;">:</span><span style="color:#ADBAC7;"> </span><span style="color:#F69D50;">UseRequestReturnType</span><span style="color:#ADBAC7;">&lt;</span><span style="color:#F69D50;">P</span><span style="color:#ADBAC7;">, </span><span style="color:#F69D50;">T</span><span style="color:#ADBAC7;">&gt; {</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> [</span><span style="color:#6CB6FF;">data</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">setData</span><span style="color:#ADBAC7;">] </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">useState</span><span style="color:#ADBAC7;">&lt;</span><span style="color:#F69D50;">T</span><span style="color:#ADBAC7;">&gt;(initData);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> [</span><span style="color:#6CB6FF;">loading</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">setLoading</span><span style="color:#ADBAC7;">] </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">useState</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">false</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">run</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">useCallback</span><span style="color:#ADBAC7;">(</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#F47067;">async</span><span style="color:#ADBAC7;"> (</span><span style="color:#F69D50;">params</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">=&gt;</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">      </span><span style="color:#DCBDFB;">setLoading</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">true</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">      </span><span style="color:#F47067;">try</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> { </span><span style="color:#6CB6FF;">isSuccess</span><span style="color:#ADBAC7;">, </span><span style="color:#6CB6FF;">result</span><span style="color:#ADBAC7;"> } </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">await</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">apiService</span><span style="color:#ADBAC7;">(params);</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#F47067;">if</span><span style="color:#ADBAC7;"> (isSuccess) {</span></span>
<span class="line"><span style="color:#ADBAC7;">          </span><span style="color:#DCBDFB;">setData</span><span style="color:#ADBAC7;">(result);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">          </span><span style="color:#768390;">// å¤„ç† Modal ä¿å­˜æˆåŠŸåï¼Œè°ƒç”¨ hideModal()ï¼Œç»„ä»¶é”€æ¯å‰å…ˆå®Œæˆ loading state æ›´æ–°</span></span>
<span class="line"><span style="color:#ADBAC7;">          </span><span style="color:#768390;">// é¿å… dev server Warningï¼šCan&#39;t perform a React state update on an unmounted component.</span></span>
<span class="line"><span style="color:#ADBAC7;">          </span><span style="color:#DCBDFB;">setLoading</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">false</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">          onSuccess </span><span style="color:#F47067;">&amp;&amp;</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">onSuccess</span><span style="color:#ADBAC7;">(result);</span></span>
<span class="line"><span style="color:#ADBAC7;">        }</span></span>
<span class="line"><span style="color:#ADBAC7;">      } </span><span style="color:#F47067;">catch</span><span style="color:#ADBAC7;"> (error) {</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#768390;">// é”™è¯¯ä¿¡æ¯ç”± services/request message.error() æŠ›å‡º</span></span>
<span class="line"><span style="color:#ADBAC7;">        console.</span><span style="color:#DCBDFB;">log</span><span style="color:#ADBAC7;">(error);</span></span>
<span class="line"><span style="color:#ADBAC7;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">      </span><span style="color:#DCBDFB;">setLoading</span><span style="color:#ADBAC7;">(</span><span style="color:#6CB6FF;">false</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">    },</span></span>
<span class="line"><span style="color:#ADBAC7;">    [apiService, onSuccess],</span></span>
<span class="line"><span style="color:#ADBAC7;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F47067;">return</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">    data,</span></span>
<span class="line"><span style="color:#ADBAC7;">    loading,</span></span>
<span class="line"><span style="color:#ADBAC7;">    run,</span></span>
<span class="line"><span style="color:#ADBAC7;">    setData,</span></span>
<span class="line"><span style="color:#ADBAC7;">  };</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span>
<span class="line"></span></code></pre></div><p>ğŸŸ¢ ä½¿ç”¨æ³›å‹ä¼ é€’ç±»å‹å‚æ•°ï¼Œæ–¹ä¾¿ç±»å‹æ¨å¯¼ã€‚</p><p>ğŸŸ¢ è¿™é‡Œä½¿ç”¨äº†ä¸¤æ¬¡ <code>setLoading(false)</code> ï¼Œåœ¨ <code>onSuccess</code> ä¹‹å‰ä½¿ç”¨æ˜¯å› ä¸ºï¼Œé¡¹ç›®å­˜åœ¨ä¸€ç§ä¸šåŠ¡æƒ…å†µï¼Œåœ¨â€œä¿å­˜å®Œæˆâ€åå…³é—­ Modalï¼Œä½†æ˜¯<code>hideModal()</code> æ˜¯é€šè¿‡ <code>onSuccess</code> è°ƒç”¨çš„ï¼Œæ‰€ä»¥åœ¨ Modal å…³é—­ä¹‹åï¼Œå†å»æ›´æ–° stateï¼Œæ§åˆ¶å°å°±ä¼šæŠ¥ Warningï¼Œ React ä¼šæé†’å¼€å‘è€…ä¸è¦åœ¨å¸è½½çš„ç»„ä»¶æ‰§è¡ŒçŠ¶æ€æ›´æ–°ã€‚</p><p>ğŸŸ¢ ä¸Šé¢æœ‰æåˆ°é¡¹ç›®å¯¹é”™è¯¯ä¿¡æ¯æœ‰ç»Ÿä¸€å¤„ç†ï¼Œæ‰€ä»¥ä¸éœ€è¦æŠ›å‡º errorã€‚</p><p>ğŸŸ¢ è¿”å›å€¼æ˜¯ä»¥å¯¹è±¡çš„å½¢å¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åƒ State Hook ä¸€æ ·ä»¥æ•°ç»„çš„å½¢å¼è¿”å›ã€‚å…¶å®ä¹Ÿå°±æ˜¯è§£æ„èµ‹å€¼è¯­æ³•å¯¹äºæ•°ç»„å’Œå¯¹è±¡çš„åŒºåˆ«ï¼Œè¿™é‡Œä¸ªäººä½¿ç”¨ä¹ æƒ¯ã€‚</p><ul><li>è§£æ„æ•°ç»„ï¼šå¿…é¡»æŒ‰é¡ºåºè·å–å€¼ï¼Œç›´æ¥å‘½åï¼›</li><li>è§£æ„å¯¹è±¡ï¼šå¿…é¡»ä½¿ç”¨è¿”å›å¯¹è±¡å¯¹åº”çš„å­—æ®µè·å–å€¼ï¼Œè§£æ„å‘½åï¼›</li></ul><h3 id="ä½¿ç”¨" tabindex="-1">ä½¿ç”¨ <a class="header-anchor" href="#ä½¿ç”¨" aria-hidden="true">#</a></h3><p>ğŸ“‚ src/../component.tsx</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#F47067;">import</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#768390;">//...</span></span>
<span class="line"><span style="color:#ADBAC7;">  useRequest,</span></span>
<span class="line"><span style="color:#ADBAC7;">} </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;hooks&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">import</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#768390;">//...</span></span>
<span class="line"><span style="color:#ADBAC7;">  apiSearch,</span></span>
<span class="line"><span style="color:#ADBAC7;">  apiSave,</span></span>
<span class="line"><span style="color:#ADBAC7;">} </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;services/api&#39;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">//...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">// å£°æ˜æŸ¥è¯¢ request</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">// ä¸éœ€è¦å¤„ç†è¿”å›æ•°æ®çš„æƒ…å†µï¼Œç›´æ¥ä½¿ç”¨æŠ›å‡ºçš„ data</span></span>
<span class="line"><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> { </span><span style="color:#F69D50;">data</span><span style="color:#ADBAC7;">: </span><span style="color:#6CB6FF;">dataList</span><span style="color:#ADBAC7;">, </span><span style="color:#F69D50;">run</span><span style="color:#ADBAC7;">: </span><span style="color:#6CB6FF;">runSearch</span><span style="color:#ADBAC7;">, </span><span style="color:#F69D50;">loading</span><span style="color:#ADBAC7;">: </span><span style="color:#6CB6FF;">searchBtnLoading</span><span style="color:#ADBAC7;"> } </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">useRequest</span><span style="color:#ADBAC7;">(apiSearch);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">// éœ€è¦å¤„ç†è¿”å›æ•°æ®çš„æƒ…å†µï¼Œåœ¨ onSuccess é‡Œè·å– result</span></span>
<span class="line"><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F69D50;">run</span><span style="color:#ADBAC7;">: </span><span style="color:#6CB6FF;">runSearch</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F69D50;">loading</span><span style="color:#ADBAC7;">: </span><span style="color:#6CB6FF;">searchBtnLoading</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F69D50;">setData</span><span style="color:#ADBAC7;">: </span><span style="color:#6CB6FF;">setDataList</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">} </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">useRequest</span><span style="color:#ADBAC7;">(apiSearch, (</span><span style="color:#F69D50;">result</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">=&gt;</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#768390;">// å¤„ç†å‡ºå‚</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">tmp</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">format</span><span style="color:#ADBAC7;">(result);</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#DCBDFB;">setDataList</span><span style="color:#ADBAC7;">(tmp);</span></span>
<span class="line"><span style="color:#ADBAC7;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">// å£°æ˜ä¿å­˜ request</span></span>
<span class="line"><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> { </span><span style="color:#F69D50;">loading</span><span style="color:#ADBAC7;">: </span><span style="color:#6CB6FF;">saveBtnLoading</span><span style="color:#ADBAC7;">, </span><span style="color:#F69D50;">run</span><span style="color:#ADBAC7;">: </span><span style="color:#6CB6FF;">runSave</span><span style="color:#ADBAC7;"> } </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">useRequest</span><span style="color:#ADBAC7;">(apiSave, () </span><span style="color:#F47067;">=&gt;</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#768390;">//...</span></span>
<span class="line"><span style="color:#ADBAC7;">  message.</span><span style="color:#DCBDFB;">success</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">&#39;ä¿å­˜æˆåŠŸ&#39;</span><span style="color:#ADBAC7;">);</span></span>
<span class="line"><span style="color:#ADBAC7;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">// æŸ¥è¯¢</span></span>
<span class="line"><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">onSearch</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> () </span><span style="color:#F47067;">=&gt;</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#768390;">// å¤„ç†å…¥å‚</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#768390;">//...</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#DCBDFB;">runSearch</span><span style="color:#ADBAC7;">(params);</span></span>
<span class="line"><span style="color:#ADBAC7;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#768390;">// ä¿å­˜</span></span>
<span class="line"><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> </span><span style="color:#DCBDFB;">onSave</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> () </span><span style="color:#F47067;">=&gt;</span><span style="color:#ADBAC7;"> {</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#768390;">// å¤„ç†å…¥å‚</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#768390;">//...</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#DCBDFB;">runSave</span><span style="color:#ADBAC7;">(params);</span></span>
<span class="line"><span style="color:#ADBAC7;">};</span></span>
<span class="line"></span></code></pre></div><p>ğŸŸ¢ params ï¼Œresult éƒ½ä¼šæœ‰ç±»å‹æ ¡éªŒï¼Œè¿™é‡Œä¹Ÿå°±ä½“ç°å‡ºç”¨ ts çš„å¥½å¤„äº†ã€‚</p><h2 id="æ€»ç»“" tabindex="-1">æ€»ç»“ <a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a></h2><p>å¤§åŠŸå‘Šæˆï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡ Hook çš„æ–¹å¼å»è¿›è¡Œæ•°æ®è¯·æ±‚äº†ï¼Œä¸éœ€è¦ CV é‡å¤çš„ä»£ç ï¼Œä»£ç ç»“æ„ä¹Ÿæ›´ <strong>prettier</strong> ï¼Œè¿™ç¯‡æ–‡ç« ä»¥æˆ‘é¡¹ç›®ä¸­è‡ªå®šä¹‰ Hook çš„æ–¹æ¡ˆä½œä¸ºåˆ†äº«ï¼Œæœ‰ä»»ä½•ä¼˜åŒ–å»ºè®®æˆ–è€…é—®é¢˜æ¬¢è¿å„ä½å¤§ä½¬è¯„è®ºåŒºæŒ‡å‡ºï¼Œå¦‚æœæœ¬æ–‡çš„æ–¹æ¡ˆå¯¹ä½ æœ‰äº›è®¸å¸®åŠ©&amp;å¯å‘ ã€‚</p>`,41),e=[o];function t(c,r,y,A,D,i){return a(),n("div",null,e)}const F=s(l,[["render",t]]);export{C as __pageData,F as default};
