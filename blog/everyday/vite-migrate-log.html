<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React 项目 Vite 迁移记录 | Jinyang's Blog</title>
    <meta name="description" content="share.">
    <link rel="preload stylesheet" href="/assets/style.06993eef.css" as="style">
    <link rel="modulepreload" href="/assets/chunks/VPAlgoliaSearchBox.2503284a.js">
    <link rel="modulepreload" href="/assets/app.5b5c79b2.js">
    <link rel="modulepreload" href="/assets/blog_everyday_vite-migrate-log.md.a3c43fe9.lean.js">
    
    <meta name="theme-color" content="#3c8772">
  <link rel="icon" href="/icon.ico">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-93a960b4><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-93a960b4 data-v-0fa0e57d><div class="VPNavBar has-sidebar" data-v-0fa0e57d data-v-be450ad9><div class="container" data-v-be450ad9><div class="title" data-v-be450ad9><div class="VPNavBarTitle has-sidebar" data-v-be450ad9 data-v-6d2fb2d9><a class="title" href="/" data-v-6d2fb2d9><!--[--><!--]--><!----><!--[-->Jinyang&#39;s Blog<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-be450ad9><div class="curtain" data-v-be450ad9></div><div class="content-body" data-v-be450ad9><!--[--><!--]--><div class="VPNavBarSearch search" data-v-be450ad9 style="--6d05f576:&#39;Meta&#39;;"><div id="docsearch"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-be450ad9 data-v-bdedfc22><span id="main-nav-aria-label" class="visually-hidden" data-v-bdedfc22>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" data-v-bdedfc22 data-v-95f5d58b data-v-30c06bd3><!--[-->Home<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="https://github.com/Jinyang79" target="_blank" rel="noreferrer" data-v-bdedfc22 data-v-95f5d58b data-v-30c06bd3><!--[-->About<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-be450ad9 data-v-da3f667a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-da3f667a data-v-0d529b6d data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-0d529b6d><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-0d529b6d><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-be450ad9 data-v-2ab2a029 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/Jinyang79/blog-vitepress" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-be450ad9 data-v-f38c483a data-v-96001b6b><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-96001b6b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-96001b6b><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-96001b6b><div class="VPMenu" data-v-96001b6b data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-f38c483a><div class="item appearance" data-v-f38c483a><p class="label" data-v-f38c483a>Appearance</p><div class="appearance-action" data-v-f38c483a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" aria-checked="false" data-v-f38c483a data-v-0d529b6d data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-0d529b6d><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-0d529b6d><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-f38c483a><div class="item social-links" data-v-f38c483a><div class="VPSocialLinks social-links-list" data-v-f38c483a data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/Jinyang79/blog-vitepress" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-be450ad9 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav" data-v-93a960b4 data-v-2817d72e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-2817d72e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-2817d72e><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-2817d72e>Menu</span></button><a class="top-link" href="#" data-v-2817d72e>Return to top</a></div><aside class="VPSidebar" data-v-93a960b4 data-v-c79ccefa><div class="curtain" data-v-c79ccefa></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-c79ccefa><span class="visually-hidden" id="sidebar-aria-label" data-v-c79ccefa> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-c79ccefa><section class="VPSidebarItem level-0 collapsible has-active" data-v-c79ccefa data-v-b05232f3><div class="item" role="button" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link" data-v-b05232f3 data-v-30c06bd3><!--[--><h2 class="text" data-v-b05232f3>Everyday</h2><!--]--><!----></a><div class="caret" role="button" data-v-b05232f3><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-b05232f3><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-b05232f3><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/blog/everyday/code-style" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>Code Style</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/blog/everyday/antd-upgrade-log" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>AntD 4.x 升级记录</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link is-active has-active" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/blog/everyday/vite-migrate-log" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>React 项目 Vite 迁移记录</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/blog/everyday/cdn-in-react" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>React 项目中引入 CDN</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/blog/everyday/util-xlsx" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>前端导入导出 by SheetJs</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/blog/everyday/use-request" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>React Hook - useRequest</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/blog/everyday/low-code" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>Low-code 活动页平台实践</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/blog/everyday/signalr" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>React 中使用 SignalR</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/blog/everyday/redux-toolkit" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>Redux Toolkit 使用技巧</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-c79ccefa><section class="VPSidebarItem level-0 collapsible" data-v-c79ccefa data-v-b05232f3><div class="item" role="button" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link" data-v-b05232f3 data-v-30c06bd3><!--[--><h2 class="text" data-v-b05232f3>DevTools</h2><!--]--><!----></a><div class="caret" role="button" data-v-b05232f3><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-b05232f3><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-b05232f3><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/blog/devtools/development-tools" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>Development Tools</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/blog/devtools/tampermonkey-script" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>Tampermonkey Script</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b05232f3 data-v-b05232f3><div class="item" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link link" href="/blog/devtools/remote-wake-mac" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>远程唤醒连接 Mac</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-c79ccefa><div class="VPSidebarItem level-0 collapsible" data-v-c79ccefa data-v-b05232f3><div class="item" role="button" data-v-b05232f3><div class="indicator" data-v-b05232f3></div><a class="VPLink link" data-v-b05232f3 data-v-30c06bd3><!--[--><p class="text" data-v-b05232f3>CodeLife</p><!--]--><!----></a><div class="caret" role="button" data-v-b05232f3><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-b05232f3><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><!----></div></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-93a960b4 data-v-0bd490fb><div class="VPDoc has-sidebar has-aside" data-v-0bd490fb data-v-c5936a1e><div class="container" data-v-c5936a1e><div class="aside" data-v-c5936a1e><div class="aside-curtain" data-v-c5936a1e></div><div class="aside-container" data-v-c5936a1e><div class="aside-content" data-v-c5936a1e><div class="VPDocAside" data-v-c5936a1e data-v-cdc66372><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-cdc66372 data-v-5dd9d5f6><div class="content" data-v-5dd9d5f6><div class="outline-marker" data-v-5dd9d5f6></div><div class="outline-title" data-v-5dd9d5f6>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-5dd9d5f6><span class="visually-hidden" id="doc-outline-aria-label" data-v-5dd9d5f6> Table of Contents for current page </span><ul class="root" data-v-5dd9d5f6 data-v-1188541a><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-cdc66372></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-c5936a1e><div class="content-container" data-v-c5936a1e><!--[--><!--]--><main class="main" data-v-c5936a1e><div style="position:relative;" class="vp-doc _blog_everyday_vite-migrate-log" data-v-c5936a1e><div><h1 id="react-项目-vite-迁移记录" tabindex="-1">React 项目 Vite 迁移记录 <a class="header-anchor" href="#react-项目-vite-迁移记录" aria-hidden="true">#</a></h1><p><img src="https://raw.githubusercontent.com/Jinyangava/blog-image/master/img/202201221849441.jpg" alt="youxiaoyou"></p><h2 id="前言" tabindex="-1">前言 <a class="header-anchor" href="#前言" aria-hidden="true">#</a></h2><p>Vite 2.0 正式版在 21 年春节就发布了，之前一直有在关注尤大的社交账号，尤大在论坛上疯狂安利，当时就留下了很深的印象，正好今年 6 月，我有一场公司的分享会，于是想把手上的一个 React 小项目迁移，记录踩坑，然后作为分享内容。<strong>这里只是记录了我在项目中迁移遇到的坑，其他问题基本上可以在 <a href="https://github.com/Vitejs/Vite/issues" target="_blank" rel="noreferrer">Vite/issue</a> 中找到</strong>。最后关于 Vite 和<a href="https://Vitejs.cn/guide/why.html#why-Vite" target="_blank" rel="noreferrer">为什么选 Vite</a>，本文就不再阐述，官网已经给出了答案，Let&#39;s go！</p><p>先来看看迁移后的效果（同一项目的启动时间）</p><p>通过 webpack 启动，<strong>大概在 45s 左右</strong>。</p><p><img src="https://raw.githubusercontent.com/Jinyangava/blog-image/master/img/202112261817225.gif" alt="dev by webpack"></p><p>通过 Vite 启动，<strong>时间大概在 1.2s！！！</strong> 😱</p><p><img src="https://raw.githubusercontent.com/Jinyangava/blog-image/master/img/202112261817609.gif" alt="dev by Vite"></p><h2 id="开始迁移" tabindex="-1">开始迁移 <a class="header-anchor" href="#开始迁移" aria-hidden="true">#</a></h2><h3 id="移除-webpack-相关文件-依赖" tabindex="-1">移除 webpack 相关文件/依赖 <a class="header-anchor" href="#移除-webpack-相关文件-依赖" aria-hidden="true">#</a></h3><p>1.项目经过 eject 后会暴露配置，移除 <code>config</code> <code>scripts</code> 目录。</p><p><img src="https://raw.githubusercontent.com/Jinyangava/blog-image/master/img/202112261749441.png" alt="image-20210626181607914"><img src="https://raw.githubusercontent.com/Jinyangava/blog-image/master/img/202112261749403.png" alt="image-20210626183201556"></p><p>2.移除所有 webpack 相关依赖（webpack, xxx-loader, xxx-webpack-plugin，babel-xxx，postcss-xxx）</p><h3 id="引入-vite" tabindex="-1">引入 Vite <a class="header-anchor" href="#引入-vite" aria-hidden="true">#</a></h3><p>install devDependencies</p><div class="language-powershell"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#ADBAC7;">yarn add Vite @Vitejs</span><span style="color:#F47067;">/</span><span style="color:#ADBAC7;">plugin</span><span style="color:#F47067;">-</span><span style="color:#ADBAC7;">react</span><span style="color:#F47067;">-</span><span style="color:#ADBAC7;">refresh </span><span style="color:#F47067;">-</span><span style="color:#ADBAC7;">D</span></span>
<span class="line"></span></code></pre></div><p>创建 <code>Vite.config.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#768390;">// Vite.config.js</span></span>
<span class="line"><span style="color:#F47067;">import</span><span style="color:#ADBAC7;"> { defineConfig } </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;Vite&quot;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#F47067;">import</span><span style="color:#ADBAC7;"> reactRefresh </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;@Vitejs/plugin-react-refresh&quot;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">export</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">default</span><span style="color:#F69D50;"> </span><span style="color:#DCBDFB;">defineConfig</span><span style="color:#F69D50;">({</span></span>
<span class="line"><span style="color:#F69D50;">  </span><span style="color:#ADBAC7;">plugins: [</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">// react-refresh插件</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#DCBDFB;">reactRefresh</span><span style="color:#ADBAC7;">(),</span></span>
<span class="line"><span style="color:#ADBAC7;">  ]</span><span style="color:#F69D50;">,</span></span>
<span class="line"><span style="color:#F69D50;">})</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span></code></pre></div><p>修改 <code>package.json</code></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#768390;">// package.json</span></span>
<span class="line"><span style="color:#ADBAC7;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#8DDB8C;">&quot;scripts&quot;</span><span style="color:#ADBAC7;">: {</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#8DDB8C;">&quot;start&quot;</span><span style="color:#ADBAC7;">: </span><span style="color:#96D0FF;">&quot;Vite&quot;</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#8DDB8C;">&quot;build&quot;</span><span style="color:#ADBAC7;">: </span><span style="color:#96D0FF;">&quot;Vite build&quot;</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#8DDB8C;">&quot;preview&quot;</span><span style="color:#ADBAC7;">: </span><span style="color:#96D0FF;">&quot;Vite preview&quot;</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#FF938A;font-style:italic;">...</span></span>
<span class="line"><span style="color:#ADBAC7;">  }</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span>
<span class="line"></span></code></pre></div><p>(如果没有使用 TypeScript，可以去除 <code>tsc</code>)</p><p>修改 <code>index.html</code></p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#ADBAC7;">&lt;!</span><span style="color:#8DDB8C;">DOCTYPE</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">html</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">&lt;</span><span style="color:#8DDB8C;">html</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">lang</span><span style="color:#ADBAC7;">=</span><span style="color:#96D0FF;">&quot;zh-CN&quot;</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">  &lt;</span><span style="color:#8DDB8C;">head</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">&lt;!-- ... --&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">    &lt;</span><span style="color:#8DDB8C;">link</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">rel</span><span style="color:#ADBAC7;">=</span><span style="color:#96D0FF;">&quot;manifest&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">href</span><span style="color:#ADBAC7;">=</span><span style="color:#96D0FF;">&quot;/src/assets/manifest.json&quot;</span><span style="color:#ADBAC7;"> /&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">    &lt;</span><span style="color:#8DDB8C;">link</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">rel</span><span style="color:#ADBAC7;">=</span><span style="color:#96D0FF;">&quot;shortcut icon&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">href</span><span style="color:#ADBAC7;">=</span><span style="color:#96D0FF;">&quot;/src/assets/favicon.ico&quot;</span><span style="color:#ADBAC7;"> /&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">&lt;!-- ... --&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">  &lt;/</span><span style="color:#8DDB8C;">head</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">  &lt;</span><span style="color:#8DDB8C;">body</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">&lt;!-- ... --&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">    &lt;</span><span style="color:#8DDB8C;">div</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">id</span><span style="color:#ADBAC7;">=</span><span style="color:#96D0FF;">&quot;root&quot;</span><span style="color:#ADBAC7;">&gt;&lt;/</span><span style="color:#8DDB8C;">div</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">    &lt;</span><span style="color:#8DDB8C;">script</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">type</span><span style="color:#ADBAC7;">=</span><span style="color:#96D0FF;">&quot;module&quot;</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">src</span><span style="color:#ADBAC7;">=</span><span style="color:#96D0FF;">&quot;/src/index.jsx&quot;</span><span style="color:#ADBAC7;">&gt;&lt;/</span><span style="color:#8DDB8C;">script</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">  &lt;/</span><span style="color:#8DDB8C;">body</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">&lt;/</span><span style="color:#8DDB8C;">html</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"></span></code></pre></div><p>将 <code>public/index.html</code> 移至根目录下，其他文件移至 <code>src/assets/</code> 下, 然后可以移除 <code>public</code> 目录。</p><h3 id="启动-dev-server" tabindex="-1">启动 dev server <a class="header-anchor" href="#启动-dev-server" aria-hidden="true">#</a></h3><div class="language-powershell"><button title="Copy Code" class="copy"></button><span class="lang">powershell</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#ADBAC7;">yarn start</span></span>
<span class="line"></span></code></pre></div><p><img src="https://raw.githubusercontent.com/Jinyangava/blog-image/master/img/202112261749614.png" alt="image-20210630180546833"><img src="https://raw.githubusercontent.com/Jinyangava/blog-image/master/img/202112261749274.png" alt="image-20210630180708132"></p><p>项目正常启动了，控制台抛出一大堆错误，无法显示页面，这时就<strong>需要我们对项目的开发环境和生产环境做一些调整</strong>，才能保证我们的项目正常运行。</p><h3 id="开发环境" tabindex="-1">开发环境 <a class="header-anchor" href="#开发环境" aria-hidden="true">#</a></h3><hr><h4 id="浏览器兼容" tabindex="-1">浏览器兼容 <a class="header-anchor" href="#浏览器兼容" aria-hidden="true">#</a></h4><p>Vite2 使用了 ESM ，不支持 IE 等旧浏览器，可以使用官方插件 <a href="https://github.com/Vitejs/Vite/tree/main/packages/plugin-legacy" target="_blank" rel="noreferrer">@Vitejs/plugin-legacy</a> 对其支持</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#768390;">// Vite.config.js</span></span>
<span class="line"><span style="color:#F47067;">import</span><span style="color:#ADBAC7;"> legacy </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;@Vitejs/plugin-legacy&quot;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">export</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">default</span><span style="color:#F69D50;"> {</span></span>
<span class="line"><span style="color:#F69D50;">  </span><span style="color:#ADBAC7;">plugins: [</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#DCBDFB;">legacy</span><span style="color:#ADBAC7;">({</span></span>
<span class="line"><span style="color:#ADBAC7;">      targets: [</span><span style="color:#96D0FF;">&quot;defaults&quot;</span><span style="color:#ADBAC7;">, </span><span style="color:#96D0FF;">&quot;not IE 11&quot;</span><span style="color:#ADBAC7;">],</span></span>
<span class="line"><span style="color:#ADBAC7;">    }),</span></span>
<span class="line"><span style="color:#ADBAC7;">  ]</span><span style="color:#F69D50;">,</span></span>
<span class="line"><span style="color:#F69D50;">}</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span></code></pre></div><h4 id="proxy" tabindex="-1">Proxy <a class="header-anchor" href="#proxy" aria-hidden="true">#</a></h4><p>为开发服务器配置自定义代理规则，我项目使用的是 <a href="https://www.npmjs.com/package/http-proxy-middleware" target="_blank" rel="noreferrer">http-proxy-middleware</a>。</p><p>在 Vite 中使用 <a href="https://Vitejs.cn/config/#server-proxy" target="_blank" rel="noreferrer">server.proxy</a> 配置代理</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#768390;">// Vite.config.js</span></span>
<span class="line"><span style="color:#F47067;">export</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">default</span><span style="color:#F69D50;"> </span><span style="color:#DCBDFB;">defineConfig</span><span style="color:#F69D50;">({</span></span>
<span class="line"><span style="color:#F69D50;">  </span><span style="color:#ADBAC7;">server: {</span></span>
<span class="line"><span style="color:#ADBAC7;">    proxy: {</span></span>
<span class="line"><span style="color:#ADBAC7;">      </span><span style="color:#96D0FF;">&quot;/xxxxService&quot;</span><span style="color:#ADBAC7;">: {</span></span>
<span class="line"><span style="color:#ADBAC7;">        target: </span><span style="color:#96D0FF;">&quot;http://xxxx.dev.com&quot;</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">        changeOrigin: </span><span style="color:#6CB6FF;">true</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#DCBDFB;">rewrite</span><span style="color:#ADBAC7;">: (</span><span style="color:#F69D50;">path</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">=&gt;</span><span style="color:#ADBAC7;"> path.</span><span style="color:#DCBDFB;">replace</span><span style="color:#ADBAC7;">(</span><span style="color:#96D0FF;">/</span><span style="color:#F47067;">^</span><span style="color:#8DDB8C;font-weight:bold;">\/</span><span style="color:#96D0FF;">xxxxService/</span><span style="color:#ADBAC7;">, </span><span style="color:#96D0FF;">&quot;&quot;</span><span style="color:#ADBAC7;">),</span></span>
<span class="line"><span style="color:#ADBAC7;">      },</span></span>
<span class="line"><span style="color:#ADBAC7;">    },</span></span>
<span class="line"><span style="color:#ADBAC7;">  }</span><span style="color:#F69D50;">,</span></span>
<span class="line"><span style="color:#F69D50;">})</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span></code></pre></div><h4 id="自定义-antd-主题色" tabindex="-1">自定义 antd 主题色 <a class="header-anchor" href="#自定义-antd-主题色" aria-hidden="true">#</a></h4><p>使用 <a href="https://github.com/onebay/vite-plugin-imp" target="_blank" rel="noreferrer">vite-plugin-imp</a> 按需导入样式。</p><p>通过 css.preprocessorOptions 指定传递给 CSS 预处理器的选项，自定义样式。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#768390;">// Vite.config.js</span></span>
<span class="line"><span style="color:#F47067;">import</span><span style="color:#ADBAC7;"> VitePluginImp </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;Vite-plugin-imp&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">export</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">default</span><span style="color:#F69D50;"> </span><span style="color:#DCBDFB;">defineConfig</span><span style="color:#F69D50;">({</span></span>
<span class="line"><span style="color:#F69D50;">  </span><span style="color:#ADBAC7;">css: {</span></span>
<span class="line"><span style="color:#ADBAC7;">    preprocessorOptions: {</span></span>
<span class="line"><span style="color:#ADBAC7;">      less: {</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#768390;">// 支持内联 JavaScript</span></span>
<span class="line"><span style="color:#ADBAC7;">        javascriptEnabled: </span><span style="color:#6CB6FF;">true</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#768390;">// 重写 less 变量，定制样式</span></span>
<span class="line"><span style="color:#ADBAC7;">        modifyVars: {</span></span>
<span class="line"><span style="color:#ADBAC7;">          </span><span style="color:#96D0FF;">&#39;@primary-color&#39;</span><span style="color:#ADBAC7;">: </span><span style="color:#96D0FF;">&#39;#29b7b7&#39;</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">          </span><span style="color:#96D0FF;">&#39;@link-color&#39;</span><span style="color:#ADBAC7;">: </span><span style="color:#96D0FF;">&#39;#29b7b7&#39;</span></span>
<span class="line"><span style="color:#ADBAC7;">        }</span></span>
<span class="line"><span style="color:#ADBAC7;">      }</span></span>
<span class="line"><span style="color:#ADBAC7;">    },</span></span>
<span class="line"><span style="color:#ADBAC7;">  plugins: [</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">// 按需引用的插件, 因为主题设置不能 modifyVars</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#DCBDFB;">VitePluginImp</span><span style="color:#ADBAC7;">({</span></span>
<span class="line"><span style="color:#ADBAC7;">      libList: [</span></span>
<span class="line"><span style="color:#ADBAC7;">        {</span></span>
<span class="line"><span style="color:#ADBAC7;">          libName: </span><span style="color:#96D0FF;">&#39;antd&#39;</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">          </span><span style="color:#DCBDFB;">style</span><span style="color:#ADBAC7;">: (</span><span style="color:#F69D50;">name</span><span style="color:#ADBAC7;">) </span><span style="color:#F47067;">=&gt;</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">`antd/es/${</span><span style="color:#ADBAC7;">name</span><span style="color:#96D0FF;">}/style`</span></span>
<span class="line"><span style="color:#ADBAC7;">        }</span></span>
<span class="line"><span style="color:#ADBAC7;">      ]</span></span>
<span class="line"><span style="color:#ADBAC7;">    })</span></span>
<span class="line"><span style="color:#ADBAC7;">  ],</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ADBAC7;">})</span></span>
<span class="line"></span></code></pre></div><h4 id="postcss" tabindex="-1">Postcss <a class="header-anchor" href="#postcss" aria-hidden="true">#</a></h4><p><a href="https://Vitejs.cn/config/#css-postcss" target="_blank" rel="noreferrer">css.postcss</a></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#F47067;">import</span><span style="color:#ADBAC7;"> flexbugsFixes </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;postcss-flexbugs-fixes&quot;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#F47067;">import</span><span style="color:#ADBAC7;"> presetEnv </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;postcss-preset-env&quot;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"><span style="color:#F47067;">import</span><span style="color:#ADBAC7;"> postcssNormalize </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;postcss-normalize&quot;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">export</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">default</span><span style="color:#F69D50;"> </span><span style="color:#DCBDFB;">defineConfig</span><span style="color:#F69D50;">({</span></span>
<span class="line"><span style="color:#F69D50;">  </span><span style="color:#ADBAC7;">css: {</span></span>
<span class="line"><span style="color:#ADBAC7;">    postcss: {</span></span>
<span class="line"><span style="color:#ADBAC7;">      plugins: [</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#DCBDFB;">flexbugsFixes</span><span style="color:#ADBAC7;">(),</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#DCBDFB;">postcssNormalize</span><span style="color:#ADBAC7;">(),</span></span>
<span class="line"><span style="color:#ADBAC7;">        </span><span style="color:#DCBDFB;">presetEnv</span><span style="color:#ADBAC7;">({</span></span>
<span class="line"><span style="color:#ADBAC7;">          autoprefixer: {</span></span>
<span class="line"><span style="color:#ADBAC7;">            flexbox: </span><span style="color:#96D0FF;">&quot;no-2009&quot;</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">          },</span></span>
<span class="line"><span style="color:#ADBAC7;">          stage: </span><span style="color:#6CB6FF;">3</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">        }),</span></span>
<span class="line"><span style="color:#ADBAC7;">      ],</span></span>
<span class="line"><span style="color:#ADBAC7;">    },</span></span>
<span class="line"><span style="color:#ADBAC7;">  }</span><span style="color:#F69D50;">,</span></span>
<span class="line"><span style="color:#F69D50;">})</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span></code></pre></div><h4 id="路径别名问题" tabindex="-1">路径别名问题 <a class="header-anchor" href="#路径别名问题" aria-hidden="true">#</a></h4><p>❌ error:</p><p><img src="https://raw.githubusercontent.com/Jinyangava/blog-image/master/img/202112261749773.png" alt="image-20210630181211545"></p><p>🐛 Fix:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#768390;">// import { resolve } from &#39;path&#39;</span></span>
<span class="line"><span style="color:#768390;">// ...</span></span>
<span class="line"><span style="color:#F47067;">export</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">default</span><span style="color:#F69D50;"> </span><span style="color:#DCBDFB;">defineConfig</span><span style="color:#F69D50;">({</span></span>
<span class="line"><span style="color:#F69D50;">  </span><span style="color:#768390;">// ...</span></span>
<span class="line"><span style="color:#F69D50;">  </span><span style="color:#ADBAC7;">resolve: {</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">// 写法1</span></span>
<span class="line"><span style="color:#ADBAC7;">    alias: [{ find:</span><span style="color:#96D0FF;"> /</span><span style="color:#F47067;">^</span><span style="color:#96D0FF;">~/</span><span style="color:#ADBAC7;">, replacement: </span><span style="color:#96D0FF;">&quot;&quot;</span><span style="color:#ADBAC7;"> }],</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">// 写法2</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">// alias: {</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">//   &#39;@&#39;: resolve(__dirname, &#39;src&#39;),</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">// },</span></span>
<span class="line"><span style="color:#ADBAC7;">  }</span><span style="color:#F69D50;">,</span></span>
<span class="line"><span style="color:#F69D50;">})</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span></code></pre></div><blockquote><p><a href="https://github.com/Vitejs/Vite/issues/2185" target="_blank" rel="noreferrer">https://github.com/Vitejs/Vite/issues/2185</a></p></blockquote><h4 id="process-is-not-defined" tabindex="-1">process is not defined <a class="header-anchor" href="#process-is-not-defined" aria-hidden="true">#</a></h4><p>❌ error:</p><p>process is not defined</p><p>🐛 Fix:</p><p>Vite 中不再使用 <code>p<wbr>rocess.env.XXX</code> 来读取环境变量，取而代之的是使用 <a href="https://Vitejs.cn/guide/env-and-mode.html" target="_blank" rel="noreferrer">i<wbr>mport.meta.env</a> 对象上暴露环境变量</p><blockquote><p>为了防止意外地将一些环境变量泄漏到客户端，只有以 <code>VITE_</code> 为前缀的变量才会暴露给经过 Vite 处理的代码。</p></blockquote><p><a href="http://nodejs.cn/api/process/process_argv.html" target="_blank" rel="noreferrer">process.argv</a></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#F47067;">---</span><span style="color:#ADBAC7;"> p<wbr>rocess.env.</span><span style="color:#6CB6FF;">REACT_APP_BUILD_ENV</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> process.argv[</span><span style="color:#6CB6FF;">2</span><span style="color:#ADBAC7;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F47067;">---</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">env</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> p<wbr>rocess.env.</span><span style="color:#6CB6FF;">REACT_APP_BUILD_ENV</span></span>
<span class="line"><span style="color:#F47067;">+++</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">env</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">import</span><span style="color:#ADBAC7;">.</span><span style="color:#6CB6FF;">meta</span><span style="color:#ADBAC7;">.env.</span><span style="color:#6CB6FF;">VITE_APP_ENV</span></span>
<span class="line"></span></code></pre></div><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#768390;">// package.json</span></span>
<span class="line"><span style="color:#96D0FF;">&quot;scripts&quot;</span><span style="color:#ADBAC7;">: {</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#8DDB8C;">&quot;start&quot;</span><span style="color:#ADBAC7;">: </span><span style="color:#96D0FF;">&quot;cross-env VITE_APP_ENV=loacl Vite&quot;</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">// ...</span></span>
<span class="line"><span style="color:#ADBAC7;">  },</span></span>
<span class="line"></span></code></pre></div><h4 id="vite-tsconfig-paths" tabindex="-1">Vite-tsconfig-paths <a class="header-anchor" href="#vite-tsconfig-paths" aria-hidden="true">#</a></h4><p>❌ error:</p><p>使用 tsconfig baseUrl 失效问题</p><p>🐛 Fix:</p><p><a href="https://github.com/aleclarson/Vite-tsconfig-paths" target="_blank" rel="noreferrer">Vite-tsconfig-paths</a> 提供 <a href="https://github.com/Vitejs/Vite" target="_blank" rel="noreferrer"><code>Vite</code></a> 使用 TypeScript 的路径映射解析导入的能力。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#F69D50;">plugins</span><span style="color:#ADBAC7;">: [</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">// ...</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#768390;">// 解决 tsconfig baseUrl 失效问题</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#DCBDFB;">tsconfigPaths</span><span style="color:#ADBAC7;">(),</span></span>
<span class="line"><span style="color:#ADBAC7;">  ],</span></span>
<span class="line"></span></code></pre></div><h4 id="require-is-not-defined" tabindex="-1">require is not defined <a class="header-anchor" href="#require-is-not-defined" aria-hidden="true">#</a></h4><p>❌ error:</p><p><img src="https://raw.githubusercontent.com/Jinyangava/blog-image/master/img/202112261750088.png" alt="image-20210705135729627"></p><p>🐛 Fix:</p><p>浏览器是不支持 require ，通过 ESM 导入</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#F47067;">import</span><span style="color:#ADBAC7;"> qs </span><span style="color:#F47067;">from</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&quot;query-string&quot;</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span></code></pre></div><h4 id="global-is-not-defined" tabindex="-1">global is not defined <a class="header-anchor" href="#global-is-not-defined" aria-hidden="true">#</a></h4><p>❌ error:</p><p><img src="https://raw.githubusercontent.com/Jinyangava/blog-image/master/img/202112261750996.png" alt="image-20210705144234355"></p><p>🐛 Fix:</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#768390;">&lt;!-- index.html --&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">&lt;</span><span style="color:#8DDB8C;">script</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#F47067;">const</span><span style="color:#ADBAC7;"> </span><span style="color:#6CB6FF;">global</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">=</span><span style="color:#ADBAC7;"> globalThis;</span></span>
<span class="line"><span style="color:#ADBAC7;">&lt;/</span><span style="color:#8DDB8C;">script</span><span style="color:#ADBAC7;">&gt;</span></span>
<span class="line"></span></code></pre></div><blockquote><p><a href="https://github.com/Vitejs/Vite/issues/2778" target="_blank" rel="noreferrer">https://github.com/Vitejs/Vite/issues/2778</a></p></blockquote><h3 id="生产环境" tabindex="-1">生产环境 <a class="header-anchor" href="#生产环境" aria-hidden="true">#</a></h3><hr><h4 id="修改输出路径" tabindex="-1">修改输出路径 <a class="header-anchor" href="#修改输出路径" aria-hidden="true">#</a></h4><p>指定输出路径（<a href="https://Vitejs.cn/config/#build-outdir" target="_blank" rel="noreferrer">默认为 dist</a>），我项目中使用的是 build 。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#F47067;">export</span><span style="color:#F69D50;"> </span><span style="color:#F47067;">default</span><span style="color:#F69D50;"> </span><span style="color:#DCBDFB;">defineConfig</span><span style="color:#F69D50;">({</span></span>
<span class="line"><span style="color:#F69D50;">  </span><span style="color:#ADBAC7;">build: {</span></span>
<span class="line"><span style="color:#ADBAC7;">    outDir: </span><span style="color:#96D0FF;">&quot;build&quot;</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">  }</span><span style="color:#F69D50;">,</span></span>
<span class="line"><span style="color:#F69D50;">})</span><span style="color:#ADBAC7;">;</span></span>
<span class="line"></span></code></pre></div><h4 id="环境变量配置" tabindex="-1">环境变量配置 <a class="header-anchor" href="#环境变量配置" aria-hidden="true">#</a></h4><p>这里根据项目的具体情况配置，以下仅作为参考</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#ADBAC7;">{</span></span>
<span class="line"><span style="color:#ADBAC7;">  </span><span style="color:#8DDB8C;">&quot;scripts&quot;</span><span style="color:#ADBAC7;">: {</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#8DDB8C;">&quot;start&quot;</span><span style="color:#ADBAC7;">: </span><span style="color:#96D0FF;">&quot;cross-env VITE_APP_ENV=localhost Vite&quot;</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#8DDB8C;">&quot;build&quot;</span><span style="color:#ADBAC7;">: </span><span style="color:#96D0FF;">&quot;tsc &amp;&amp; Vite build --mode localhost&quot;</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#8DDB8C;">&quot;preview&quot;</span><span style="color:#ADBAC7;">: </span><span style="color:#96D0FF;">&quot;Vite preview&quot;</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#8DDB8C;">&quot;build_dev&quot;</span><span style="color:#ADBAC7;">: </span><span style="color:#96D0FF;">&quot;tsc &amp;&amp; Vite build --mode dev&quot;</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#8DDB8C;">&quot;build_demo&quot;</span><span style="color:#ADBAC7;">: </span><span style="color:#96D0FF;">&quot;tsc &amp;&amp; Vite build --mode demo&quot;</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#8DDB8C;">&quot;build_testing&quot;</span><span style="color:#ADBAC7;">: </span><span style="color:#96D0FF;">&quot;tsc &amp;&amp; Vite build --mode testing&quot;</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#8DDB8C;">&quot;test&quot;</span><span style="color:#ADBAC7;">: </span><span style="color:#96D0FF;">&quot;node scripts/test.js&quot;</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#8DDB8C;">&quot;lint&quot;</span><span style="color:#ADBAC7;">: </span><span style="color:#96D0FF;">&quot;eslint --ext jsx,js src&quot;</span><span style="color:#ADBAC7;">,</span></span>
<span class="line"><span style="color:#ADBAC7;">    </span><span style="color:#8DDB8C;">&quot;lint_fix&quot;</span><span style="color:#ADBAC7;">: </span><span style="color:#96D0FF;">&quot;eslint --fix src&quot;</span></span>
<span class="line"><span style="color:#ADBAC7;">  }</span></span>
<span class="line"><span style="color:#ADBAC7;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-env"><button title="Copy Code" class="copy"></button><span class="lang">env</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#adbac7;">// .env.testing</span></span>
<span class="line"><span style="color:#adbac7;">NODE_ENV=production</span></span>
<span class="line"><span style="color:#adbac7;">VITE_APP_ENV=testing</span></span>
<span class="line"><span style="color:#adbac7;"></span></span></code></pre></div><h4 id="cannot-read-property-definelocale-of-undefined" tabindex="-1">Cannot read property &#39;defineLocale&#39; of undefined <a class="header-anchor" href="#cannot-read-property-definelocale-of-undefined" aria-hidden="true">#</a></h4><p><img src="https://raw.githubusercontent.com/Jinyangava/blog-image/master/img/202112261750685.png" alt="image-20210708113519756"></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark-dimmed"><code><span class="line"><span style="color:#F47067;">---</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">import</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;moment/locale/zh-cn&#39;</span></span>
<span class="line"><span style="color:#F47067;">+++</span><span style="color:#ADBAC7;"> </span><span style="color:#F47067;">import</span><span style="color:#ADBAC7;"> </span><span style="color:#96D0FF;">&#39;moment/dist/locale/zh-cn&#39;</span></span>
<span class="line"></span></code></pre></div><h4 id="failed-to-resolve-module-specifier-indexof" tabindex="-1">Failed to resolve module specifier &quot;indexof&quot; <a class="header-anchor" href="#failed-to-resolve-module-specifier-indexof" aria-hidden="true">#</a></h4><p><img src="https://raw.githubusercontent.com/Jinyangava/blog-image/master/img/202112261750989.png" alt="image-20210708145138025"></p><p><a href="https://github.com/Vitejs/Vite/issues/2670" target="_blank" rel="noreferrer">https://github.com/Vitejs/Vite/issues/2670</a></p><p>调整完成后，项目就可以正常运行啦🎉。</p><h2 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-hidden="true">#</a></h2><blockquote><p><a href="https://Vitejs.cn/" target="_blank" rel="noreferrer">https://Vitejs.cn/</a></p><p><a href="https://github.com/Vitejs/Vite/issues" target="_blank" rel="noreferrer">https://github.com/Vitejs/Vite/issues</a></p><p><a href="https://blog.mutoe.com/2021/react-Vite-migration/" target="_blank" rel="noreferrer">https://blog.mutoe.com/2021/react-Vite-migration/</a></p></blockquote></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-c5936a1e data-v-e033cd21><div class="edit-info" data-v-e033cd21><!----><div class="last-updated" data-v-e033cd21><p class="VPLastUpdated" data-v-e033cd21 data-v-355aa5ef>Last updated: <time datetime="2023-03-26T06:55:36.000Z" data-v-355aa5ef></time></p></div></div><div class="prev-next" data-v-e033cd21><div class="pager" data-v-e033cd21><a class="pager-link prev" href="/blog/everyday/antd-upgrade-log" data-v-e033cd21><span class="desc" data-v-e033cd21>Previous page</span><span class="title" data-v-e033cd21>AntD 4.x 升级记录</span></a></div><div class="has-prev pager" data-v-e033cd21><a class="pager-link next" href="/blog/everyday/cdn-in-react" data-v-e033cd21><span class="desc" data-v-e033cd21>Next page</span><span class="title" data-v-e033cd21>React 项目中引入 CDN</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"blog_devtools_tampermonkey-script.md\":\"49823d62\",\"blog_everyday_low-code.md\":\"b0ce46fa\",\"blog_devtools_development-tools.md\":\"7aa9e2dc\",\"blog_everyday_cdn-in-react.md\":\"ef37702a\",\"blog_everyday_code-style.md\":\"2571fdf9\",\"blog_devtools_remote-wake-mac.md\":\"cae06896\",\"components_typer.md\":\"0745703e\",\"blog_everyday_use-request.md\":\"adbbf5e5\",\"blog_everyday_signalr.md\":\"fb0c3be8\",\"blog_everyday_redux-toolkit.md\":\"e0673a7c\",\"blog_everyday_util-xlsx.md\":\"e27e98ee\",\"index.md\":\"6553a5fc\",\"blog_everyday_antd-upgrade-log.md\":\"b256cd60\",\"blog_everyday_vite-migrate-log.md\":\"a3c43fe9\"}")</script>
    <script type="module" async src="/assets/app.5b5c79b2.js"></script>
    
  </body>
</html>